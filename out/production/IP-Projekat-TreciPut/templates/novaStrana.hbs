<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Projekat - izmena automobila</title>
    <link href="http://127.0.0.1:5000/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="/">
        <i class="fas fa-car fa-2x text-info"></i>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="/">Početna <span class="sr-only">(current)</span></a>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="/admin-strana">Admin strana</a>
            </li>
            <li class="nav-item>
                <a class="nav-link" href="/novi-automobil">Novi automobil></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/odjava">Odjavite se</a>
            </li>
        </ul>
    </div>
</nav>

<div class="px-4 my-3 mb-5">
    <div class="row">
        <div class="col-md-6 col-lg-5">
            <div class="p-4 bg-dark text-light" id="prikaz">
                    <h4 class="font-weight-normal py-3 text-center">Izmenite Automobil</h4>
                    <select id="odabir-izmene" onchange="prikaziZaOdabrano()">
                        <option value="null">Odaberite automobil</option>
                        {{#each automobili}}
                            <option value="{{this.id}}">{{this.marka}} {{this.model}}</option>
                        {{/each}}
                    </select>
                    <input type="hidden" name="id-automobila" id="id-automobila">
                    <div class="mb-4 mt-2 w-100 text-center">
                        <img src="" id="slika-prikaz" style="width: 350px; height: 250px; border-radius: 5px; object-fit: contain !important;" alt="Slika">
                    </div>
                    <label for="slika" class="font-weight-bold">Odaberite novu sliku:</label>
                    <input type="file" onchange="izmenaSlike()" class="mb-3" name="slika" id="slika">
                    <div class="alert alert-success p-3 font-weight-bold text-center d-none" id="poruka">
                        Uspešno ste izmenili podatke Automobila!
                    </div>
                    <h4 class="font-weight-normal py-3 text-center">Dodajte novi Automobil</h4>
                    <div class="alert alert-success p-3 font-weight-bold text-center d-none" id="poruka">
                        Uspešno ste dodali novi Automobil!
                    </div>

                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <i class="fas fa-car-side"></i>
                        </span>
                    </div>
                    <input type="text" class="form-control" name="marka" id="marka" placeholder="Marka Automobila">
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <i class="fas fa-car-side"></i>
                        </span>
                    </div>
                    <input type="text" class="form-control" name="model" id="model" placeholder="Model Automobila">
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <i class="fas fa-euro-sign"></i>
                        </span>
                    </div>
                    <input type="number" class="form-control" name="cena" id="cena" placeholder="Cena Automobila">
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <i class="far fa-calendar-alt"></i>
                        </span>
                    </div>
                    <input type="number" class="form-control" name="godiste" id="godiste" placeholder="Godište Automobila">
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <small class="font-weight-bold">cm<sup>3</sup></small>
                        </span>
                    </div>
                    <input type="number" class="form-control" name="kubikaza" id="kubikaza" placeholder="Kubikaza Automobila">
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <i class="fas fa-car-side"></i>
                        </span>
                    </div>
                    <select class="form-control" name="karoserija" id="karoserija">
                        <option value="null">Karoserija Automobila</option>
                        <option value="Limuzina">Limuzina</option>
                        <option value="Hečbek">Hečbek</option>
                        <option value="Karavan">Karavan</option>
                        <option value="Džip/SUV">Džip/SUV</option>
                        <option value="Pickup">Pickup</option>
                        <option value="Kabriolet">Kabriolet</option>
                        <option value="Kupe">Kupe</option>
                    </select>
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <i class="fas fa-car-side"></i>
                        </span>
                    </div>
                    <select class="form-control" name="menjac" id="menjac">
                        <option value="null">Menjač Automobila</option>
                        <option value="Manuelni">Manuelni</option>
                        <option value="Automatski">Automatski</option>
                    </select>
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <i class="fas fa-oil-can"></i>
                        </span>
                    </div>
                    <select class="form-control" name="gorivo" id="gorivo">
                        <option value="null">Gorivo Automobila</option>
                        <option value="Benzin">Benzin</option>
                        <option value="Dizel">Dizel</option>
                        <option value="Benzin+Gas(TNG)">Benzin+Gas(TNG)</option>
                        <option value="Metan CNG">Metan CNG</option>
                    </select>
                </div>
                <input type="button" onclick="izmenaPodataka()" class="btn btn-block btn-info font-weight-bold mt-4" value="Izmeni podatke Automobila">

            </div>
        </div>
    </div>
</div>


<div class="bg-dark text-light text-center p-4">
    Copyright &copy; <h6 class="d-inline">Milovan Srejić NRT-11/17</h6>
</div>


<script src="http://127.0.0.1:5000/js/jquery-3.4.1.min.js"></script>
<script src="http://127.0.0.1:5000/js/bootstrap.min.js"></script>
<script>
    function prikaziZaOdabrano() {
        $.ajax({
            type: "POST",
            url: "/dohvatiPoId",
            data: {
                "id": document.querySelector("#odabir-izmene").value
            },
            dataType: "json",
            success: function (response) {
                document.querySelector("#id-automobila").value = `${response.id}`;
                document.querySelector("#slika-prikaz").setAttribute("src",`${response.slika}`);
                document.querySelector("#marka").value = `${response.marka}`;
                document.querySelector("#model").value =`${response.model}`
                document.querySelector("#cena").value = `${response.cena}`;
                document.querySelector("#godiste").value = `${response.godiste}`;
                document.querySelector("#kubikaza").value = `${response.kubikaza}`;
                document.querySelector("#karoserija").value = `${response.karoserija}`;
                document.querySelector("#menjac").value = `${response.menjac}`;
                document.querySelector("#gorivo").value = `${response.gorivo}`;
            }
        });
    }
    function izmenaSlike() {
        let inputSlika = document.querySelector("#slika");
        let arrSlika = inputSlika.value.split(".");
        let inputId = document.querySelector("#id-automobila");
        let imgSlikaPrikaz = document.querySelector("#slika-prikaz");
        if(arrSlika[arrSlika.length-1].toLowerCase() != "png" &&
                arrSlika[arrSlika.length-1].toLowerCase() != "jpg" &&
                arrSlika[arrSlika.length-1].toLowerCase() != "jpeg" &&
                arrSlika[arrSlika.length-1].toLowerCase() != "gif"){
            inputSlika.value = "";
            alert(`Niste odabrali sliku u dozvoljenom formatu(png,jpg,jpeg,gif)!\n`);
        }
        else {
            let fd = new FormData();
            fd.append("slika", inputSlika.files[0]);
            fd.append("id",inputId.value);
            $.ajax({
                url: "/izmeniSlikuAutomobila",
                data: fd,
                processData: false,
                contentType: false,
                enctype: 'multipart/form-data',
                type: "POST",
                dataType: "json",
                success: function (response) {
                    inputSlika.value = "";
                    imgSlikaPrikaz.setAttribute("src",response);
                }
            });
        }
    }
    function izmenaPodataka() {
        let inputId = document.querySelector("#id-automobila");
        let inputMarka = document.querySelector("#marka");
        let inputModel = document.querySelector("#model");
        let inputCena= document.querySelector("#cena");
        let inputGodiste = document.querySelector("#godiste");
        let inputKubikaza = document.querySelector("#kubikaza");
        let selectKaroserija = document.querySelector("#karoserija");
        let selectMenjac = document.querySelector("#menjac");
        let selectGorivo = document.querySelector("#gorivo");
        if(inputMarka.value == "" || inputModel.value == "" || inputGodiste.value == "" || inputCena.value == "" ||
                inputKubikaza.value == "" || selectKaroserija.value == "null" || selectMenjac.value == "null" ||
                selectGorivo.value == "null"){
            alert("Sva polja moraju biti popunjena!");
        }
        else {
            let poruka = "";
            let patternMarka = /^[A-Z]{1}[A-Za-z ]{1,}$/;
            let patternModel = /^[A-Z0-9]{1}[A-Za-z0-9 ]{1,}$/;
            if(inputMarka.value.match(patternMarka) == null) {
                poruka += `Marka nije u dozvoljenom formatu!\n`;
                inputMarka.value = "";
            }
            if(inputModel.value.match(patternModel) == null) {
                poruka += `Model nije u dozvoljenom formatu!\n`;
                inputModel.value = "";
            }
            if(inputGodiste.value < 1980 || inputGodiste.value > new Date().getFullYear()){
                poruka += `Godište mora biti veće od 1980 i manje od ` + new Date().getFullYear() + `!\n`;
                inputGodiste.value = "";
            }
            if(inputKubikaza.value < 500 || inputKubikaza.value > 6000){
                poruka += `Kubikaža mora biti veća od 500 i manja od 6000!`;
                inputKubikaza.value = "";
            }
            if(poruka != ""){
                alert(poruka);
            }
            else {
                $.ajax({
                    type: "POST",
                    url: "/izmeniPodatkeAutomobil",
                    data: {
                        "id": inputId.value,
                        "marka": inputMarka.value,
                        "model": inputModel.value,
                        "cena": inputCena.value,
                        "godiste": inputGodiste.value,
                        "kubikaza": inputKubikaza.value,
                        "karoserija": selectKaroserija.value,
                        "menjac": selectMenjac.value,
                        "gorivo": selectGorivo.value
                    },
                    dataType: "json",
                    success: function (response) {
                        document.querySelector("#poruka").classList.add("d-block");
                        document.querySelector("#poruka").classList.remove("d-none");
                        console.log(response);
                    }
                });
            }
        }
    }
</script>

</body>
